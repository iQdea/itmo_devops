# Требования к разрабатываемому Dockerfile

## Docker: Мультистейджинг, сборка и запуск

Цель лабораторной: освоить подход создания легковесного образа путем сборки приложения на одном образе, и запуска на другом. Рекомендуется использовать любое опенсорс приложение требующее SDK для сборки.

1. Образ должен быть легковесным

    ==> Сборка в 2 этапа с JRE + scratch + volumes (см. пункты 3, 4, 8)

2. Образ должен быть на базе scratch

    `FROM scratch AS <name>`

3. Сборка приложения должна происходить в первом образе

    ==> `FROM <...> AS build`

4. Запуск приложения выполняется в новом образе, через копирование артефакта

    ==> `FROM <...> AS production`

    ==> `COPY --from=build <...>.jar <...>.jar`

5. Вся конфигурация выполняется через переменные окружения

    ==> .env
    ==> Приложение основано на Spring Boot, поэтому позволяет конфигурироваться через перемнные окружения

6. Всё оформлено в одном Dockerfile

    ==> Несколько `FROM <...> AS <name>` в одном Dockerfile

7. Создать файл docker-compose для старта и сборки

    ==> docker-compose.yaml

8. Зависимости из первого образа переходят во второй как volume

    ==> JRE создается в первом образе

    ==> Объявляется каждый образ из Dockerfile как отдельный сервис

    ==> Создается volume dependency-volume

    ==> Передаются файлы сборки между двумя сервисами через dependency-volume (в каждом из стейджей в Dockerfile монтируется volume dependencies для передачи файлов во внешний volume dependency-volume)
